# Access the id_github file from Secret Manager, and setup SSH
steps:
  - name: 'gcr.io/cloud-builders/mvn'
    id: "build"
    entrypoint: 'bash'
    args:
      - -c
      - |
        ls -l

#  # Clone the repository
#  - name: 'gcr.io/cloud-builders/gcloud'
#    entrypoint: /bin/sh
#    args:
#      - '-c'
#      - |
#        gcloud functions deploy quarkus-example-http \
#          --gen2 \
#          --memory="256Mi"  \
#          --max-instances=2 \
#          --region $_REGION \
#          --vpc-connector $_VPC_CONNECTOR \
#          --entry-point=io.quarkus.gcp.functions.QuarkusHttpFunction \
#          --runtime=java11 --trigger-http --allow-unauthenticated --source=target/deployment
#
#  - name: gcr.io/cloud-builders/git
#    id: Clone CD
#    secretEnv: [ 'TOKEN_GITHUB' ]
#    entrypoint: /bin/sh
#    args:
#      - '-c'
#      - |
#        cd /workspace && \
#        git clone https://AxlRoe:$$TOKEN_GITHUB@github.com/AxlRoe/$_CD_REPO.git && \
#        mkdir -p $_CD_REPO/functions && \
#        cd $_CD_REPO/functions && \
#        git config user.email $(gcloud auth list --filter=status:ACTIVE --format='value(account)') && \
#
#        cp -r /root/deployment .
#        git checkout -b $_FUNCTION_NAME"-"$SHORT_SHA && \
#        git add *.jar && \
#        git commit -m "Added $_FUNCTION_NAME candidate" && \
#        git push -u origin $_FUNCTION_NAME"-"$SHORT_SHA
#
#availableSecrets:
#  secretManager:
#    - versionName: projects/$PROJECT_ID/secrets/$_SECRET_NAME/versions/latest
#      env: 'TOKEN_GITHUB'
